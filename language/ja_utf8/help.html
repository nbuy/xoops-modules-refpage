<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html language="ja">
<head>
<title>XOOPS 用 参照元情報モジュール</title>
<style>
.outer { background-color: #808080; }
td,th { padding: 4px; background: #e8e8e8;}
.head th  { padding: 4px; background: #d0d0d0; }
.bnf { color: #008000; }
</style>
</head>
<body>
<style>
.note { font-size: 90%; color: #800000; padding: 0.5em;}
</style>
<h1>XOOPS 用 参照元情報 (refpage) モジュール</h1>

<p>このモジュールは、XOOPS のページの参照元 (リンク) 情報を自動的に
記録し表示を行うものです。 </p>

<ul>
  <li><a href="#requirement">動作条件</a></li>
  <li><a href="#install">導入と利用方法</a></li>
  <li><a href="#style">スタイルシートの指定</a></li>
  <li><a href="#admin">管理機能</a></li>
  <li><a href="#acknowledgments">謝辞</a></li>
  <li><a href="#changes">変更履歴</a></li>
</ul>

<a name="requirement"></a><h2>動作条件</h2>

本モジュールの動作条件は次の通りです。

<ul>
  <li>XOOPS 2.0.x 以降で動作します</li>
  <li>マルチバイト文字を扱う場合 PHP の mbstring が必要です</li>
  <li>ライセンスは XOOPS 本体と同じ GPL2 に準拠します</li>
</ul>

<a name="install"></a><h2>導入と利用方法</h2>

アーカイブを XOOPS_ROOT_PATH/modules/ 以下へ展開 (アップロード) 
して、XOOPS のモジュール管理でインストールを行ってください。

<ol>
   <li>ファイルのアップロード</li>
   <li>モジュール管理でモジュールのインストールを行う</li>
   <li>グループ管理で「登録ユーザ」「匿名ユーザ」にアクセス権を設定 <a href="#note1">[*1]</a></li>
   <li>ブロック管理で表示位置を決め表示を有効にする <a href="#note2">[*2]</a></li>
</ol>
<dl>
    <dt><a name="note1">[*1]</a></dt>
    <dd>参照元情報の閲覧を許可する場合、ブロックとモジュールのア
	クセス権を設定します。情報を非公開にする場合もブロックの
	アクセス権は許可してください。</dd>

    <dt><a name="note2">[*2]</a></dt>
    <dd>ブロックを使って記録を行うため、ブロックが表示できる状態
	でなければモジュールは機能しません。参照元情報を非公開に
	したい場合は、モジュール設定にブロックの内容を非表示に指
	定します。</dd>
</dl>

以上の設定が終わったら、後は自動で処理が行われます。

<a name="style"></a><h2>スタイルシートの指定</h2>

参照元情報のページで、表示するフォントサイズや色などを変更する場
合、スタイルシートを使います。具体的には、テーマのスタイルシート
や xoops.css ファイルに、次のような指定を行います。
<pre>
.trtitle { color: #0000c0; } /* タイトル */
.trtext { /* 参照元のテキスト */
    font-size: small; text-align: left; margin-left: 1em; 
}
.trinfo { /* 付属情報 */
    font-size: x-small; text-align: left; 
}
</pre>

<a name="admin"></a><h2>管理機能</h2>

管理機能では、記録の対象となるページの無効化や参照元情報の表示/
非表示などの制御、手動でリンクの確認、細かい動作の指定を行います。

<h3>参照情報の編集</h3>

  <p>参照ページの一覧では、参照元がリンクしている自サイト内のページ
  の一覧が表示されます。ここでは、チェックボックスに印をつけて、
  変更ボタンを押すことで特定のページの記録をそれ以降中止させるこ
  とができます。</p>

  <p>無効化したページを有効にするには、状態による表示で「無効」また
  は「すべて」を指定して一覧に表示させてチェックを外して変更を行
  います。</p>

<h3>参照ページ情報の編集</h3>

  <p>参照対象ページをリンクしている参照元を個別表示し、表示の有無を
  指定します。</p>

  <p>また、参照元情報には、強制更新のチェックボックスが指定できる場
  合には付いています。これに印をつけて変更を行うと、次に誰かが該
  当リンクをクリックした際に参照元の情報を再度取得します。</p>

<h3>参照元の確認</h3>

  <p>このモジュールでは、参照元を自動的に検査して参照されたページへ
  のリンクが存在することを確認しています。その確認に失敗した場合、
  未確認の参照元となります。</p>

  <p>参照元の確認では、参照元を管理者が手動で確認してリンク表示の
  指示を行います。</p>

<h3>追跡記録の削除</h3>

  <p>アクセスの少ない参照や無効なリンク元情報を削除します。</p>

<h3>モジュール設定</h3>

<p>モジュールに関する各種設定を行います。</p>

<blockquote>
<table border="0" cellspacing="1" cellpadding="4" class="outer">
  <tr><th>項目</th><th>値</th><th>説明</th></tr>
  <tr class="even">
    <td class="head">参照元の自動確認</td>
    <td>[u]する[/u]/しない</td>
    <td><p>自動で行う参照元の確認を指示します。既定値は「する」で、
      これを行わない場合、全て管理者が確認やリンク表示の指示を行
      うことになります。</p>
      <p>非公開で参照元 URL の記録のみを行いたい場合に使うとよいで
      しょう。</p>
    </td>
  </tr>
  <tr class="odd">
    <td class="head">ブロックに情報を表示</td>
    <td>[u]する[/u]/しない</td>
    <td><p>ブロックの中にリンク情報を表示するかどうか指示します。既定
      値は [する] で、参照元情報をまったく非公開にしたい場合にし
      ます。</p>
    </td>
  </tr>
  <tr class="even">
    <td class="head">表示する項目数</td>
    <td>25</td>
    <td>1ページに表示する参照元数を指定し、この数でページを分割します。</td>
  </tr>
  <tr class="odd">
    <td class="head">タイトルの最大長</td>
    <td>タイトル文字列の最大長 (〜255)</td>
    <td>タイトルを表示する場合の文字列の長さを指定します。これを越
      えた場合、表示上は切り詰められます。記録自体は常に 255 文
      字まで行われます。
    </td>
  </tr>
  <tr class="even">
    <td class="head">切り出す参照本文の長さ</td>
    <td>200</td>
    <td>参照元のリンクの周辺の文字を指定した長さで切り出しデータベースへ記録します。
      (〜65536バイト)
    </td>
  </tr>
  <tr class="odd">
    <td class="head">参照元の再確認日数</td>
    <td>30</td>
    <td>前回リンクがクリックされてからの日数が指定の日数を越えていた場合、
      参照元の再確認が行われます。
    </td>
  </tr>
  <tr class="even">
    <td class="head">確認なしにリンクを非表示とする参照元</td>
    <td>URI のリスト</td>
    <td>検索エンジンからの参照など、参照元の確認動作をさせたくない
      サイトを指定していします。指定はドメインとパスで行い、任意
      の文字列として '*' が指定できます。
    </td>
  </tr>
  <tr class="odd">
    <td class="head">確認なしにリンクを表示する参照元</td>
    <td>URI のリスト</td>
    <td>前項目と似ていますが、こちらは無条件に信用してリンクを行い
      ます。お友達サイトなど、内容を出すまでもないが、リンクは常
      に行う場合に指定します。
    </td>
  </tr>
</table>
</blockquote>

<h3>ブロックの設定</h3>

ブロック管理から行う「参照元情報」ブロックの編集では、「表示行数」
および「一行の文字数」の指定ができます。

<a name="acknowledgments"></a><h2>謝辞</h2>

<p>本モジュールの開発で、nao-pon さん (<a
href="http://hypweb.net/xoops/">サイト</a>) よりコードや助言を頂
きました。また、t_miyabi さん、toshii さんからはフォーラムでテス
ト報告を頂きました。御協力ありがとうございます。</p>

<a name="changes"></a><h2>変更履歴</h2>

<dl>
  <dd>[2010/01/31] refpage 1.95 (2.0β2)
    <ul>
      <li>管理ページで削除処理後のリダイレクトでメニューが出ないように修正</li>
      <li>既存の取得文字列が空の時、更新処理を再度行う</li>
    </ul>
  </dd>
  <dd>[2010/01/31] refpage 1.95 (2.0β2)
    <ul>
      <li>管理ページで削除処理後のリダイレクトでメニューが出ないように修正</li>
      <li>既存の取得文字列が空の時、更新処理を再度行う</li>
    </ul>
  </dd>
  <dd>[2010/01/31] refpage 1.95 (2.0β2)
    <ul>
      <li>管理ページで URI絞り込みを追加</li>
      <li>help ページをメニューに追加</li>
      <li>参照元記録の障害を修正</li>
    </ul>
  </dd>
  <dd>[2010/01/11] refpage 1.94 (2.0β)
    <ul>
      <li>XOOPS 2.0 以降に専用化 (config/template 対応)</li>
      <li>モジュール名称 (dirname) を変更</li>
    </ul>
  </dd>
  <dd>[2009/05/05] trackback-1.2 リリース
    <ul>
      <li>HTTP_*_VARS の変数名を変更</li>
      <li>XCL 2.1/altsys で動作するように修正</li>
    </ul>
  </dd>
  <dd>[2004/11/03] trackback-1.1.1 リリース</dd>
  <dd>[2004/11/03] XOOPS2 で管理メニューのリソースが設定されない</dd>
  <dd>[2004/11/03] 記録されない障害を修正</dd>
  <dd>[2004/10/25] trackback-1.1 リリース</dd>
  <dd>[2004/10/02] 表題にまとめて表示</dd>
  <dd>[2004/08/18] データの削除機能を追加</dd>
  <dd>[2004/02/11] ページ切替を省略表示する</dd>
  <dd>[2004/01/04] _MI_TRACKBACK_NAME が XOOPS2 で未定義になるので削除</dd>
  <dd>[2003/12/11] trackback-1.0 リリース</dd>
</dl>
--
<address>
安富 伸浩 <<a href="mailto:nobuhiro.yasutomi@nifty.ne.jp">nobuhiro.yasutomi@nifty.ne.jp</a><br/>
マイサイト ユーザーズ <a href="http://myht.org/">http://myht.org/</a>
</address>
<p>$Id: help.html,v 1.4 2010/01/31 06:04:36 nobu Exp $</p>
</body>
</html>
